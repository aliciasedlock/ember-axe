<script>
  /**
   * Setup all our functions as an extension to the global axe object. This
   * ensures their availability while also avoiding a continual pollution of the
   * global namespace.
   */
  axe.ember = {
    /**
     * Simply runs axe.a11yCheck and passes the results to {@link
     * _a11yCheckCallback}. Available publicly in case you find the need for
     * additional calls.
     * @public
     * @return {Void}
     */
    a11yCheck: function() {
      axe.a11yCheck('#ember-testing-container', axe.ember.testOptions, axe.ember.a11yCheckLogger);
    },

    /**
     * Processes the results of calling axe.a11yCheck. If there are any
     * violations, it logs them individually and then throws an error. It will
     * also pass the results through to {@link axe.ember.a11yCheckCallback} if it
     * is defined as a function.
     * @public
     * @param {Object} results
     * @return {Void}
     */
    a11yCheckLogger: function(results) {
      var violations = results.violations;

      for (var i = 0, l = violations.length; i < l; i++) {
        Ember.Logger.error('Violation #' + (i + 1), violations[i]);
      }

      var callback = axe.ember.a11yCheckCallback;
      if (callback) {
        Ember.assert('a11yCheckCallback should be a function', typeof callback === 'function');
        callback(results);
      }

      Ember.assert('The page should have no accessibility violations.', !violations.length);
    },

    /**
     * An optional callback to receive the results of the a11yCheck after the
     * logger gets them on each run.
     * @public
     * @type {Function}
     */
    a11yCheckCallback: undefined,

    /**
     * An object of options to pass into axe.a11yCheck when run.
     * @public
     * @type {Object}
     */
    testOptions: undefined
  };

  // Register the functions to their appropriate places for testing
  a11y.registerAudit(axe.ember.a11yCheck);
</script>
